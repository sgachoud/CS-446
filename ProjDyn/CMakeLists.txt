cmake_minimum_required(VERSION 3.00)

get_filename_component(PROJECTNAME ${CMAKE_CURRENT_LIST_DIR} NAME)
project(${PROJECTNAME})

set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)

include(cmake/ConfigureCompiler.cmake)
find_package(NanoGUI)
find_package(SurfaceMesh)
find_package(TetGen)

# Various preprocessor definitions have been generated by NanoGUI
add_definitions(${NANOGUI_EXTRA_DEFS})
# Eigen and OpenMP do not work well together, so disable Eigen parallelization
add_definitions(-DEIGEN_DONT_PARALLELIZE)

# On top of adding the path to nanogui/include, you may need extras
include_directories(${NANOGUI_EXTRA_INCS})

# Deploy files once to the executable dir
macro(copy_files_once)
    set(FILES_LIST "${ARGN}")
    foreach(SOME_FILE ${FILES_LIST})
        message(STATUS "Copying ${SOME_FILE} to build folder")
        file(COPY ${SOME_FILE} DESTINATION ${CMAKE_CURRENT_BINARY_DIR}/data)
    endforeach()
endmacro()

#--- Dummy target just to have data files appear in IDE
file(GLOB_RECURSE DATA "${PROJECT_SOURCE_DIR}/data/*")
add_custom_target(DGP_DATA SOURCES ${DATA})
copy_files_once(${DATA})

file(GLOB_RECURSE PDSOURCE "${PROJECT_SOURCE_DIR}/projdyn/*.h")
file(GLOB_RECURSE VIEWERSOURCE "${PROJECT_SOURCE_DIR}/viewer/*.h")
file(GLOB_RECURSE PDASOURCE "${PROJECT_SOURCE_DIR}/projdyn_api/*.h")
add_custom_target(projdyn_sources SOURCES ${PDSOURCE} ${VIEWERSOURCE} ${PDASOURCE}) 

#================================================================
# Labs and exercises
#================================================================
add_subdirectory(projdyn)
add_subdirectory(viewer)
add_subdirectory(projdyn_api)
add_subdirectory(simulation)
add_subdirectory(shapeup)
